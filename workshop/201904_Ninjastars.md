# Defense against Game Hack 2019/04/16 in Sega sammy

## 1st GameSecの課題 高橋遥
### GameSecとは
加害者が居て初めて成り立つ職種
チーター　本来と異なる動作　意図しない動作による不正行為
チートツールの作成・配布　自動ボットによるRMT　アイテムの不正取得・ステータス改ざん

(1) チーターへユーザーが変化　罪悪感のない中高生の増加
(2) 予定にないメンテナンス　ユーザーの不満・信用性損失
(3) ゲーム世界観の崩壊　ユーザー離れによるゲーム運営終了

FGO プレゼントボックスの脆弱性　不正増殖　ツール不要　被害5億円程度　ユーザーがReverse Enginneringで挙動解析により発見　メンテは4時間
対策難易度と被害額の相関が見えにくい

Android Republic 改変apk配布　被害額の推定が難しい

eSPOTS CSGOでインドのチームが不正行為　競技性に疑問

newzoo ゲームが大規模化により一般化　このときAmazonや銀行がサービスが停止すると同じような想像をしたら...

### GameSec エンジニア
プログラマとデザイナの分業化 (e.g ポケモン)
同じ様にゲームセキュリティエンジニアの需要増加　しかし参入障壁が高い

### 問題と現状
人材不足　専門性の高さ
リスクが可視化されていない　被害が不明瞭
デファクトスタンダードがない　委託先を探せない

### 解決に向けて
育成プログラムやDefense against Game Hack 不足に対抗
可視化マップ Pacifista
あとはうちが頑張るかぁ〜って感じらしい　でも沖縄にそういう企業あったよね？

## 2nd Traing Ghidra 脆弱性診断 CEDECで優勝の斎藤さん saito@ninjastars-net.com
クライアント側にも重要なロジックがあることが多い
サーバ通信による脅威 解析による脅威 --> リバースエンジニアリング

Ghidra
GUIベースの逆アセンブリ，人間にも解読可能なアセンブラへ
Javaでコーディングされている
IDAとの違いはデバッガコンポーネンツが存在しないこと

crackme01 crackme04 のリバースエンジニアリングのハンズオン　この辺はブログ見ながらやってみる

## 3rd Practice Cheater VS Ninjastars 攻防戦　猫さん
許可のないアプリケーションではやらないで

いくつかのチート手法についての実演

①memory cheat
メモリ城h\に保存されているスコア等を書き換え ステージ飛びなど
一般的にはだいたいこれ
win cheatengin andro gamegurdian

デバッガによる動的解析
HPをメモリ検索　絞り込んでデバッガでBPを貼る
書き込みしてる処理を解析

実演は倒せない敵を倒すやつ　大変可愛いゆるふわな宇宙人
cheatengineの起動　対象プロセスへのアタッチ exe指定　HP:100で検索=400研外套 --> 動作させて残量で再度詮索し絞り込む
どうやら0ニルスと不正な値として検知するらしい　別の値で試してみる 1にすると回復しちゃーーうう
そこでBPをはる　HPの監視機能があるっぽい 対象の処理を監視nopへ書き換え　勝てた

対策　各種パラメータの保存時に暗号化，理容時に復号化　メモリ検索をはじく
デバッガ対策　win:アンチデバッグIsDebuggerPresent関数　泥:子プロセスを監視

②アプリ改変
appがdnspy等で簡単にデコンパイルできる場合，ゲームの処理を理解され改変される可能性がある
今回はメモリ暗号化されているので先程の手法は使えない　HPの改変は整合性チェックで去勢終了してるよう
BPも上手く貼れないのでデコンパイラでコード見て実行プログラムを改変

対策
.NET難読化　Unityはil2cppビルド
ファイル改ざんチェック　暗号化　パッキング　関数・文字列難読化　バイナリ難読化

③cheater疑似体験
イキリどらこん　HP:99999
cheatengineやうさみみハリケーンなどを検知してゲームが終了した
デコンパイルしてもjmp()しか見れない　Appの暗号化はできている gamelogicという怪しいファイルはある


## 感想
はじめての開催もあってか，ちょっと説明が早いなぁと感じた．ハンズオンの時はもう少しゆっくりやるけれど...